<!DOCTYPE html><html lang="zh-CN"><head><meta charset="utf-8"><meta name="X-UA-Compatible" content="IE=edge"><title> 缓存淘汰算法LRU和LFU · fancxxy's blog</title><meta name="description" content="缓存淘汰算法LRU和LFU - fancxxy"><meta name="viewport" content="width=device-width, initial-scale=1"><link rel="icon" href="/favicon.png"><link rel="stylesheet" href="/css/apollo.css"><link rel="search" type="application/opensearchdescription+xml" href="https://fancxxy.github.io/atom.xml" title="fancxxy's blog"><meta name="generator" content="Hexo 6.2.0"><link rel="alternate" href="/atom.xml" title="fancxxy's blog" type="application/atom+xml">
</head><body><div class="wrap"><header><a class="logo-link" href="/"><img src="/logo.gif" alt="logo"></a><ul class="nav nav-list"><li class="nav-list-item"><a class="nav-list-link" href="/" target="_self">BLOG</a></li><li class="nav-list-item"><a class="nav-list-link" href="/archives/" target="_self">ARCHIVE</a></li><li class="nav-list-item"><a class="nav-list-link" href="/tags/" target="_self">TAGS</a></li><li class="nav-list-item"><a class="nav-list-link" href="/atom.xml" target="_self">RSS</a></li><li class="nav-list-item"><a class="nav-list-link" href="https://github.com/fancxxy" target="_blank">GITHUB</a></li><li class="nav-list-item"><a class="nav-list-link" href="https://www.weibo.com/fancxxy" target="_blank">WEIBO</a></li></ul></header><main class="container"><div class="post"><article class="post-block"><h1 class="post-title">缓存淘汰算法LRU和LFU</h1><div class="post-info">2020-07-20<a class="tag-title" href="/tags/Algorithm/">#Algorithm</a></div><div class="post-content"><p>缓存可以用来提高数据的查询速度，但缓存容量有限，当缓存达到容量上限时，需要删除部分数据来添加新的数据，常用的删除数据的策略有LRU和LFU。</p>
<span id="more"></span>

<h3 id="LRU"><a href="#LRU" class="headerlink" title="LRU"></a>LRU</h3><p>LRU（Least Recently Used）最近最少使用算法，当缓存达到容量上限删除最久没有被访问过的数据。</p>
<p>使用双向链表来存储数据，新加入的数据放到链表头，当数据被访问时把存储数据的结点移动到链表头，这样链表中结点的顺序就代表数据被访问的顺序。当链表结点数量达到设定的阈值时，丢弃链表尾结点，因为它是最久没有被访问的。</p>
<p>链表查询的时间复杂度是O(n)，可以用哈希表存储链表结点的地址，查询达到O(1)的复杂度。</p>
<div class="mxgraph" style="max-width:100%;border:1px solid transparent;" data-mxgraph="{&quot;highlight&quot;:&quot;#0000ff&quot;,&quot;nav&quot;:true,&quot;resize&quot;:true,&quot;xml&quot;:&quot;&lt;mxfile host=\&quot;Electron\&quot; modified=\&quot;2020-11-11T06:08:19.931Z\&quot; agent=\&quot;5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) draw.io/13.7.9 Chrome/85.0.4183.121 Electron/10.1.3 Safari/537.36\&quot; etag=\&quot;h4ZgnCrS8BMZ1Ck2YNPC\&quot; version=\&quot;13.7.9\&quot; type=\&quot;device\&quot;&gt;&lt;diagram id=\&quot;JlRB1wD8-z-Si42WC8DS\&quot; name=\&quot;Page-1\&quot;&gt;7Vtdb5swFP01PK6K+Qo8hpS0qjppWjete6TgghcHR8Rpkv362cFAwNCwJmFk4iWyL8bgc8+5vlyIok0X27vEW0afSQCxoo6CraLdKqpq2Rb75YZdajCtUWoIExSkJlAYntBvKIzZsDUK4Ko0kBKCKVqWjT6JY+jTks1LErIpD3sluHzVpRdCyfDke1i2/kABjcSy1HFhv4cojLIrA9NOjyy8bLBYySryArI5MGmuok0TQmjaWmynEHPsMlzS82YNR/MbS2BM25zwbM3ccO0+3n02HpYOitZO8PBJU9Np3jy8FitWXEOxZoo15Q17pNhAcW3F1hTHVVxLmQBlIny6orsMJgq37CaciC4wMwDWXNGEzOGUYJIwS0xiNtJ5RRhXTB5GYcy6PlsGZHbnDSYUMQdMxIEFCgJ+GWcTIQqflp7Pr7lhbGO2hKzjAPIVjvg155D6kei8kpjOvAXCnHn3EL9BPq04IIgGmBccGUiBLb8TuD0wCWDvIFlAmuzYEHHUFj4WJAe66G8KyuS26IAuGTc8wdIwn7lwJGsIX/6FX4Hk1jncjSS3leGrA/jAo42AlmA/A5pVOA0ZTaMGTONSYMoaYWCCKwFT0/sFpl4Hpn4lYOo9Y6ZRB6Z2LWD2jJlmHZjqlYCp9YyZVkPMNDHPE14S1gp5iw04MZK22/TPsS2NKrv8WMbYrMHYvNgmL+dhMGDZq+iShEYkJLGH3cJayZiKMY+ELAWivyClO5EheWtKynjDLaLP4nTe/snbN2NDdG+3B8dud1knZgt+zmbgncPTeL84b9/bHXNoye0wDiY82WfdF0z8+bcIxal5hnB2440UWJF14sN3gBYpPfWSENLjpOdO+Eieo1+KKHbDNlEjxhM3j87EqPVOjONBjJ2IMasMHFWj3VM1ZguQUuAaOZ6YGHcmRx30TY5yIOtQjqAkR7WlHEdlOapXIUfrytWYl+eGuH3huA1aMiULJb2jCmiqqtUE7hNrbZ0FbkPtW+C2Bz12o0e1rR5BX/VYW5hVa/V4Yh2nMz2afdOjKpfFZIHWM/UAv8BbRXus3y2K5Sq8MQ50CNqJUJyUy/CIBqtSE5p6txx3XFMdS+qE6p641heC2CKLPF4rXyh/zM6mSCEQZxXUkieyyhNJ95JiJE2052gOwAmxQX5yGvL/f1kb621Wl73KHwJcC2+3zRnOVAkd4lujI+QXLANrm8Ay28Yota+0rWaF1Q9HroW2wBi25X5VyXv7dKfKb62GCNcEltHS22eqwg77cqOczCHA9aycfKZN/ewBLqP8EOBauFtv6+0zPWYOEa6RtvJbkP2X4ppiWbzhWPtvx4cvxev5VnlRrsp8s2r4pl0sCGmSNx+/fv9vvGaex2uaqd4YZb+ZsuPAyJA994FP/Fm3+FtIKtvivzWa+wc=&lt;/diagram&gt;&lt;/mxfile&gt;&quot;,&quot;toolbar&quot;:&quot;pages zoom layers lightbox&quot;,&quot;page&quot;:0}"></div>
<script type="text/javascript" src="https://app.diagrams.net/js/viewer-static.min.js"></script>

<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> cache</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">	<span class="string">&quot;container/list&quot;</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> lruItem <span class="keyword">struct</span> &#123;</span><br><span class="line">	key   <span class="keyword">interface</span>&#123;&#125;</span><br><span class="line">	value <span class="keyword">interface</span>&#123;&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// LRU 缓存</span></span><br><span class="line"><span class="keyword">type</span> LRU <span class="keyword">struct</span> &#123;</span><br><span class="line">	capacity <span class="type">int</span></span><br><span class="line">	hash     <span class="keyword">map</span>[<span class="keyword">interface</span>&#123;&#125;]*list.Element</span><br><span class="line">	list     *list.List</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// NewLRU 创建LRU缓存</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">NewLRU</span><span class="params">(capacity <span class="type">int</span>)</span></span> *LRU &#123;</span><br><span class="line">	<span class="keyword">return</span> &amp;LRU&#123;</span><br><span class="line">		capacity: capacity,</span><br><span class="line">		hash:     <span class="built_in">make</span>(<span class="keyword">map</span>[<span class="keyword">interface</span>&#123;&#125;]*list.Element),</span><br><span class="line">		list:     list.New(),</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Get 读取数据并移动结点到链表头</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(lru *LRU)</span></span> Get(key <span class="keyword">interface</span>&#123;&#125;) <span class="keyword">interface</span>&#123;&#125; &#123;</span><br><span class="line">	<span class="keyword">if</span> lru.capacity &lt;= <span class="number">0</span> &#123;</span><br><span class="line">		<span class="keyword">return</span> <span class="literal">nil</span></span><br><span class="line">	&#125;</span><br><span class="line">	node, ok := lru.hash[key]</span><br><span class="line">	<span class="keyword">if</span> !ok &#123;</span><br><span class="line">		<span class="keyword">return</span> <span class="literal">nil</span></span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	lru.list.MoveToFront(node)</span><br><span class="line">	<span class="keyword">return</span> node.Value.(*lruItem).value</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Put 写入数据</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(lru *LRU)</span></span> Put(key, value <span class="keyword">interface</span>&#123;&#125;) &#123;</span><br><span class="line">	<span class="keyword">if</span> lru.capacity &lt;= <span class="number">0</span> &#123;</span><br><span class="line">		<span class="keyword">return</span></span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	node, ok := lru.hash[key]</span><br><span class="line">	<span class="keyword">if</span> !ok &#123;</span><br><span class="line">		<span class="keyword">if</span> lru.list.Len() &gt;= lru.capacity &#123;</span><br><span class="line">			node = lru.list.Back()</span><br><span class="line">			<span class="built_in">delete</span>(lru.hash, node.Value.(*lruItem).key)</span><br><span class="line">			lru.list.Remove(node)</span><br><span class="line">		&#125;</span><br><span class="line"></span><br><span class="line">		lru.hash[key] = lru.list.PushFront(&amp;lruItem&#123;key: key, value: value&#125;)</span><br><span class="line">		<span class="keyword">return</span></span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	node.Value = &amp;lruItem&#123;key: key, value: value&#125;</span><br><span class="line">	lru.list.MoveToFront(node)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="LFU"><a href="#LFU" class="headerlink" title="LFU"></a>LFU</h3><p>LFU（Least Frequently Used）最不经常使用，当缓存达到容量上限删除访问次数最少的数据，如果有多条数据访问次数最少，按照访问时间顺序删除最久未被访问的那条。</p>
<p>使用两张哈希表，其中一张存储缓存的key、value以及访问频率freq，另一张哈希表映射访问频率freq和所有相同访问频率的缓存数据组成的双向链表。</p>
<p>第一张哈希表通过key可以定位到某个双向链表中的某个结点，再通过结点内部的freq由第二张哈希表定位到保存这个结点的双向链表。Get的操作就是在这个链表中删除该结点，再定位到freq+1的链表上，把缓存数据插入链表头，同时更新最小访问频率。最小访问频率的作用是当缓存容量达到上限时，快速定位并删除最不经常使用的元素。Put的操作如果key已经存在时跟Get类似，区别是要给缓存重新赋值，如果key不存在则在freq&#x3D;1的链表头插入一条新缓存数据，修改最小访问频率为1。</p>
<div class="mxgraph" style="max-width:100%;border:1px solid transparent;" data-mxgraph="{&quot;highlight&quot;:&quot;#0000ff&quot;,&quot;nav&quot;:true,&quot;resize&quot;:true,&quot;xml&quot;:&quot;&lt;mxfile host=\&quot;Electron\&quot; modified=\&quot;2020-11-11T06:07:34.693Z\&quot; agent=\&quot;5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) draw.io/13.7.9 Chrome/85.0.4183.121 Electron/10.1.3 Safari/537.36\&quot; etag=\&quot;4LmIaNHm-bQZKHp_SbIl\&quot; version=\&quot;13.7.9\&quot; type=\&quot;device\&quot;&gt;&lt;diagram id=\&quot;JlRB1wD8-z-Si42WC8DS\&quot; name=\&quot;Page-1\&quot;&gt;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&lt;/diagram&gt;&lt;/mxfile&gt;&quot;,&quot;toolbar&quot;:&quot;pages zoom layers lightbox&quot;,&quot;page&quot;:0}"></div>
<script type="text/javascript" src="https://app.diagrams.net/js/viewer-static.min.js"></script>

<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> cache</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">	<span class="string">&quot;container/list&quot;</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> lfuItem <span class="keyword">struct</span> &#123;</span><br><span class="line">	key   <span class="keyword">interface</span>&#123;&#125;</span><br><span class="line">	value <span class="keyword">interface</span>&#123;&#125;</span><br><span class="line">	freq  <span class="type">int</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// LFU 缓存</span></span><br><span class="line"><span class="keyword">type</span> LFU <span class="keyword">struct</span> &#123;</span><br><span class="line">	capacity <span class="type">int</span></span><br><span class="line">	keyMap   <span class="keyword">map</span>[<span class="keyword">interface</span>&#123;&#125;]*list.Element</span><br><span class="line">	freqMap  <span class="keyword">map</span>[<span class="type">int</span>]*list.List</span><br><span class="line">	minFreq  <span class="type">int</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// NewLFU 创建LFU缓存</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">NewLFU</span><span class="params">(capacity <span class="type">int</span>)</span></span> *LFU &#123;</span><br><span class="line">	<span class="keyword">return</span> &amp;LFU&#123;</span><br><span class="line">		capacity: capacity,</span><br><span class="line">		keyMap:   <span class="keyword">map</span>[<span class="keyword">interface</span>&#123;&#125;]*list.Element&#123;&#125;,</span><br><span class="line">		freqMap:  <span class="keyword">map</span>[<span class="type">int</span>]*list.List&#123;&#125;,</span><br><span class="line">		minFreq:  <span class="number">0</span>,</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Get 读取数据</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(lfu *LFU)</span></span> Get(key <span class="keyword">interface</span>&#123;&#125;) <span class="keyword">interface</span>&#123;&#125; &#123;</span><br><span class="line">	<span class="keyword">if</span> lfu.capacity &lt;= <span class="number">0</span> &#123;</span><br><span class="line">		<span class="keyword">return</span> <span class="literal">nil</span></span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	node, ok := lfu.keyMap[key]</span><br><span class="line">	<span class="keyword">if</span> !ok &#123;</span><br><span class="line">		<span class="keyword">return</span> <span class="literal">nil</span></span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	item, ok := node.Value.(*lfuItem)</span><br><span class="line"></span><br><span class="line">	lst := lfu.freqMap[item.freq]</span><br><span class="line"></span><br><span class="line">	lst.Remove(node)</span><br><span class="line">	<span class="keyword">if</span> lst.Len() == <span class="number">0</span> &#123;</span><br><span class="line">		<span class="built_in">delete</span>(lfu.freqMap, item.freq)</span><br><span class="line">		<span class="keyword">if</span> lfu.minFreq == item.freq &#123;</span><br><span class="line">			lfu.minFreq++</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	item.freq++</span><br><span class="line">	lst, ok = lfu.freqMap[item.freq]</span><br><span class="line">	<span class="keyword">if</span> !ok &#123;</span><br><span class="line">		lst = list.New()</span><br><span class="line">	&#125;</span><br><span class="line">	lfu.keyMap[key] = lst.PushFront(item)</span><br><span class="line">	lfu.freqMap[item.freq] = lst</span><br><span class="line">	<span class="keyword">return</span> item.value</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Put 写入数据</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(lfu *LFU)</span></span> Put(key, value <span class="keyword">interface</span>&#123;&#125;) &#123;</span><br><span class="line">	<span class="keyword">if</span> lfu.capacity &lt;= <span class="number">0</span> &#123;</span><br><span class="line">		<span class="keyword">return</span></span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	node, ok := lfu.keyMap[key]</span><br><span class="line">	<span class="keyword">if</span> !ok &#123;</span><br><span class="line">		<span class="keyword">if</span> <span class="built_in">len</span>(lfu.keyMap) &gt;= lfu.capacity &#123;</span><br><span class="line">			lst := lfu.freqMap[lfu.minFreq]</span><br><span class="line">			key := lst.Back().Value.(*lfuItem).key</span><br><span class="line">			lst.Remove(lst.Back())</span><br><span class="line">			<span class="keyword">if</span> lst.Len() == <span class="number">0</span> &#123;</span><br><span class="line">				<span class="built_in">delete</span>(lfu.freqMap, lfu.minFreq)</span><br><span class="line">			&#125;</span><br><span class="line">			<span class="built_in">delete</span>(lfu.keyMap, key)</span><br><span class="line">		&#125;</span><br><span class="line"></span><br><span class="line">		item := &amp;lfuItem&#123;key: key, value: value, freq: <span class="number">1</span>&#125;</span><br><span class="line">		lst, ok := lfu.freqMap[<span class="number">1</span>]</span><br><span class="line">		<span class="keyword">if</span> !ok &#123;</span><br><span class="line">			lst = list.New()</span><br><span class="line">		&#125;</span><br><span class="line">		lfu.keyMap[key] = lst.PushFront(item)</span><br><span class="line">		lfu.freqMap[<span class="number">1</span>] = lst</span><br><span class="line">		lfu.minFreq = <span class="number">1</span></span><br><span class="line">		<span class="keyword">return</span></span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	item := node.Value.(*lfuItem)</span><br><span class="line">	lst := lfu.freqMap[item.freq]</span><br><span class="line"></span><br><span class="line">	lst.Remove(node)</span><br><span class="line">	<span class="keyword">if</span> lst.Len() == <span class="number">0</span> &#123;</span><br><span class="line">		<span class="built_in">delete</span>(lfu.freqMap, item.freq)</span><br><span class="line">		<span class="keyword">if</span> lfu.minFreq == item.freq &#123;</span><br><span class="line">			lfu.minFreq++</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	item.freq++</span><br><span class="line">	item.value = value</span><br><span class="line">	lst, ok = lfu.freqMap[item.freq]</span><br><span class="line">	<span class="keyword">if</span> !ok &#123;</span><br><span class="line">		lst = list.New()</span><br><span class="line">	&#125;</span><br><span class="line">	lfu.keyMap[key] = lst.PushFront(item)</span><br><span class="line">	lfu.freqMap[item.freq] = lst</span><br><span class="line">	<span class="keyword">return</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</div></article></div></main><footer><div class="paginator"><a class="prev" href="/2020/09/09/ICMP/">PREV</a><a class="next" href="/2019/11/23/pokemon-6v-breeding-percentage/">NEXT</a></div><div id="disqus_thread"></div><script>var disqus_shortname = 'fancxxy';
var disqus_identifier = '2020/07/20/cache-replacement-policies/';
var disqus_title = '缓存淘汰算法LRU和LFU';
var disqus_url = 'https://fancxxy.github.io/2020/07/20/cache-replacement-policies/';
(function() {
    var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
    dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
    (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
})();</script><script id="dsq-count-scr" src="//#{theme.disqus}.disqus.com/count.js" async></script><div class="copyright"><p>© 2018 - 2022 <a href="https://fancxxy.github.io">fancxxy</a>, powered by <a href="https://hexo.io/" target="_blank">Hexo</a> and <a href="https://github.com/pinggod/hexo-theme-apollo" target="_blank">hexo-theme-apollo</a>.</p></div></footer></div><script async src="//cdn.bootcss.com/mathjax/2.7.0/MathJax.js?config=TeX-MML-AM_CHTML" integrity="sha384-crwIf/BuaWM9rM65iM+dWFldgQ1Un8jWZMuh3puxb8TOY9+linwLoI7ZHZT+aekW" crossorigin="anonymous"></script></body></html>